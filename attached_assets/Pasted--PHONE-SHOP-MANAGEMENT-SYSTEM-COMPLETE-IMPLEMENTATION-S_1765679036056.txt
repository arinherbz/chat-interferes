# PHONE SHOP MANAGEMENT SYSTEM - COMPLETE IMPLEMENTATION SPEC

## PRODUCTION-READY, MULTI-TENANT, SAAS-READY SYSTEM

-----

## üéØ SYSTEM OVERVIEW

Build a **COMPLETE, PRODUCTION-READY** Phone Shop Management System that can be sold as SaaS. This is a **REAL BUSINESS APPLICATION** with:

- ‚úÖ Full remote control for owners
- ‚úÖ Multi-level permissions (Owner, Supervisor, Staff)
- ‚úÖ Complete CRUD on ALL entities
- ‚úÖ Real-time synchronization
- ‚úÖ Mobile-first responsive design
- ‚úÖ Multi-tenant architecture (SaaS-ready)
- ‚úÖ Comprehensive audit trails
- ‚úÖ Advanced reporting & analytics
- ‚úÖ Offline mode capability
- ‚úÖ Export functionality (PDF, Excel, CSV)
- ‚úÖ SMS/Email notifications ready
- ‚úÖ Payment integration ready
- ‚úÖ Cloud deployment ready (AWS/Azure/GCP)

-----

## üèóÔ∏è ARCHITECTURE

### Technology Stack

```
BACKEND:
- Python 3.10+ with Flask/FastAPI
- PostgreSQL (production) / SQLite (dev)
- SQLAlchemy ORM
- Flask-Login / JWT Authentication
- Flask-SocketIO (real-time updates)
- Celery (background tasks)
- Redis (caching & sessions)
- Alembic (database migrations)

FRONTEND:
- Modern HTML5/CSS3/JavaScript
- Bootstrap 5 / Tailwind CSS
- jQuery / Alpine.js / HTMX
- Chart.js / ApexCharts
- DataTables.js
- Socket.IO client
- Progressive Web App (PWA) support

DEPLOYMENT:
- Docker + Docker Compose
- Nginx reverse proxy
- Gunicorn/uWSGI
- SSL/TLS certificates
- Environment-based configuration
- Automated backups
- CI/CD pipeline ready
```

-----

## üìä DATABASE SCHEMA (COMPLETE)

### Core Tables

```sql
-- Multi-tenant support
CREATE TABLE shops (
    id SERIAL PRIMARY KEY,
    shop_name VARCHAR(200) NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    owner_name VARCHAR(200) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(120) UNIQUE NOT NULL,
    address TEXT,
    logo_url VARCHAR(500),
    subscription_plan VARCHAR(50) DEFAULT 'trial',
    subscription_expires_at TIMESTAMP,
    is_active BOOLEAN DEFAULT true,
    timezone VARCHAR(50) DEFAULT 'UTC',
    currency VARCHAR(10) DEFAULT 'UGX',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Users with permissions
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('Owner', 'Supervisor', 'Staff')),
    email VARCHAR(120) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(shop_id, email)
);

-- Products & Inventory
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    name VARCHAR(200) NOT NULL,
    category VARCHAR(100) NOT NULL,
    sku VARCHAR(100) UNIQUE,
    barcode VARCHAR(100),
    description TEXT,
    cost_price INTEGER DEFAULT 0,
    selling_price INTEGER NOT NULL,
    stock_quantity INTEGER DEFAULT 0,
    min_stock_level INTEGER DEFAULT 5,
    is_preloaded BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Customers
CREATE TABLE customers (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    name VARCHAR(200) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(120),
    address TEXT,
    id_number VARCHAR(50),
    date_of_birth DATE,
    gender VARCHAR(10),
    notes TEXT,
    loyalty_points INTEGER DEFAULT 0,
    total_purchases INTEGER DEFAULT 0,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Devices
CREATE TABLE devices (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    customer_id INTEGER REFERENCES customers(id) ON DELETE SET NULL,
    brand VARCHAR(100) NOT NULL,
    model VARCHAR(200) NOT NULL,
    imei_serial VARCHAR(100) NOT NULL,
    color VARCHAR(50),
    storage VARCHAR(50),
    purchase_price INTEGER,
    selling_price INTEGER,
    condition VARCHAR(50) DEFAULT 'New',
    status VARCHAR(50) DEFAULT 'In Stock',
    warranty_expires_at DATE,
    notes TEXT,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(shop_id, imei_serial)
);

-- Sales
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    sale_number VARCHAR(50) UNIQUE NOT NULL,
    customer_id INTEGER REFERENCES customers(id) ON DELETE SET NULL,
    total_amount INTEGER NOT NULL,
    discount_amount INTEGER DEFAULT 0,
    tax_amount INTEGER DEFAULT 0,
    final_amount INTEGER NOT NULL,
    payment_method VARCHAR(50) NOT NULL,
    payment_status VARCHAR(50) DEFAULT 'Paid',
    status VARCHAR(50) DEFAULT 'Submitted',
    notes TEXT,
    created_by INTEGER REFERENCES users(id),
    approved_by INTEGER REFERENCES users(id),
    approved_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Sale Items
CREATE TABLE sale_items (
    id SERIAL PRIMARY KEY,
    sale_id INTEGER REFERENCES sales(id) ON DELETE CASCADE,
    product_id INTEGER REFERENCES products(id) ON DELETE SET NULL,
    device_id INTEGER REFERENCES devices(id) ON DELETE SET NULL,
    item_name VARCHAR(200) NOT NULL,
    quantity INTEGER NOT NULL,
    unit_price INTEGER NOT NULL,
    discount_amount INTEGER DEFAULT 0,
    total_price INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Repairs
CREATE TABLE repairs (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    repair_number VARCHAR(50) UNIQUE NOT NULL,
    device_id INTEGER REFERENCES devices(id) ON DELETE SET NULL,
    customer_id INTEGER REFERENCES customers(id) ON DELETE SET NULL,
    device_brand VARCHAR(100) NOT NULL,
    device_model VARCHAR(200) NOT NULL,
    imei_serial VARCHAR(100),
    issue_description TEXT NOT NULL,
    repair_type VARCHAR(100) NOT NULL,
    estimated_cost INTEGER,
    actual_cost INTEGER,
    parts_cost INTEGER DEFAULT 0,
    labor_cost INTEGER DEFAULT 0,
    status VARCHAR(50) DEFAULT 'Pending',
    priority VARCHAR(20) DEFAULT 'Normal',
    technician_id INTEGER REFERENCES users(id),
    estimated_completion DATE,
    actual_completion TIMESTAMP,
    warranty_period INTEGER DEFAULT 30,
    notes TEXT,
    is_editable BOOLEAN DEFAULT true,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Repair Status History
CREATE TABLE repair_status_history (
    id SERIAL PRIMARY KEY,
    repair_id INTEGER REFERENCES repairs(id) ON DELETE CASCADE,
    old_status VARCHAR(50),
    new_status VARCHAR(50) NOT NULL,
    notes TEXT,
    changed_by INTEGER REFERENCES users(id),
    changed_at TIMESTAMP DEFAULT NOW()
);

-- Daily Closures
CREATE TABLE daily_closures (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    closure_date DATE NOT NULL,
    cash_amount INTEGER DEFAULT 0,
    mtn_amount INTEGER DEFAULT 0,
    airtel_amount INTEGER DEFAULT 0,
    card_amount INTEGER DEFAULT 0,
    bank_transfer INTEGER DEFAULT 0,
    other_amount INTEGER DEFAULT 0,
    total_collected INTEGER NOT NULL,
    expected_amount INTEGER NOT NULL,
    variance INTEGER NOT NULL,
    status VARCHAR(50) DEFAULT 'Submitted',
    notes TEXT,
    submitted_by INTEGER REFERENCES users(id),
    reviewed_by INTEGER REFERENCES users(id),
    reviewed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(shop_id, closure_date)
);

-- Expenses
CREATE TABLE expenses (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    category VARCHAR(100) NOT NULL,
    description TEXT NOT NULL,
    amount INTEGER NOT NULL,
    payment_method VARCHAR(50) NOT NULL,
    receipt_url VARCHAR(500),
    expense_date DATE NOT NULL,
    status VARCHAR(50) DEFAULT 'Pending',
    created_by INTEGER REFERENCES users(id),
    approved_by INTEGER REFERENCES users(id),
    approved_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Audit Logs
CREATE TABLE audit_logs (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    user_id INTEGER REFERENCES users(id) ON DELETE SET NULL,
    entity_type VARCHAR(50) NOT NULL,
    entity_id INTEGER NOT NULL,
    action VARCHAR(50) NOT NULL,
    old_value JSONB,
    new_value JSONB,
    ip_address VARCHAR(50),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Stock Movements
CREATE TABLE stock_movements (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    product_id INTEGER REFERENCES products(id) ON DELETE CASCADE,
    movement_type VARCHAR(50) NOT NULL,
    quantity INTEGER NOT NULL,
    reference_type VARCHAR(50),
    reference_id INTEGER,
    notes TEXT,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Notifications
CREATE TABLE notifications (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    type VARCHAR(50) NOT NULL,
    is_read BOOLEAN DEFAULT false,
    link VARCHAR(500),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Settings
CREATE TABLE settings (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id) ON DELETE CASCADE,
    setting_key VARCHAR(100) NOT NULL,
    setting_value TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(shop_id, setting_key)
);
```

-----

## üîê AUTHENTICATION & AUTHORIZATION

### User Roles & Permissions Matrix

```python
PERMISSIONS = {
    'Owner': {
        'sales': ['create', 'read', 'update', 'delete', 'approve', 'lock'],
        'repairs': ['create', 'read', 'update', 'delete', 'assign', 'complete'],
        'devices': ['create', 'read', 'update', 'delete'],
        'products': ['create', 'read', 'update', 'delete', 'adjust_stock'],
        'customers': ['create', 'read', 'update', 'delete'],
        'closures': ['create', 'read', 'update', 'delete', 'approve'],
        'staff': ['create', 'read', 'update', 'delete', 'suspend'],
        'expenses': ['create', 'read', 'update', 'delete', 'approve'],
        'reports': ['view_all', 'export'],
        'audit_logs': ['read'],
        'settings': ['update']
    },
    'Supervisor': {
        'sales': ['create', 'read', 'update'],
        'repairs': ['create', 'read', 'update', 'assign', 'complete'],
        'devices': ['create', 'read', 'update'],
        'products': ['read', 'adjust_stock'],
        'customers': ['create', 'read', 'update'],
        'closures': ['create', 'read', 'update', 'review'],
        'staff': ['read'],
        'expenses': ['create', 'read'],
        'reports': ['view_limited', 'export'],
        'audit_logs': [],
        'settings': []
    },
    'Staff': {
        'sales': ['create', 'read'],
        'repairs': ['create', 'read'],
        'devices': ['create', 'read'],
        'products': ['read'],
        'customers': ['create', 'read'],
        'closures': ['create', 'read'],
        'staff': [],
        'expenses': [],
        'reports': [],
        'audit_logs': [],
        'settings': []
    }
}
```

### Authentication Flow

1. Email/Password login with bcrypt hashing
1. JWT tokens (15min access, 7 days refresh)
1. Session management with Redis
1. Remember me functionality
1. Password reset via email
1. 2FA optional (TOTP)
1. API key for mobile apps

-----

## üöÄ CORE FEATURES (DETAILED)

### 1. SALES MANAGEMENT

**Staff Capabilities:**

- Create new sale
- Select preloaded products (quick add)
- Add custom products
- Add multiple items to cart
- Apply discounts (if permitted)
- Select payment method
- Print receipt
- View own sales

**Supervisor Capabilities:**

- All staff capabilities
- Edit any sale (if not locked)
- View all sales
- Generate sales reports

**Owner Capabilities:**

- All supervisor capabilities
- Delete any sale
- Approve/Reject sales
- Lock sales (final)
- Reverse sales with audit trail
- Override any field
- View profit margins
- Export sales data

**Implementation Requirements:**

```python
# Sales Endpoints
POST   /api/sales              # Create sale
GET    /api/sales              # List sales (filtered by role)
GET    /api/sales/:id          # Get single sale
PUT    /api/sales/:id          # Update sale
DELETE /api/sales/:id          # Delete sale (Owner only)
POST   /api/sales/:id/approve  # Approve sale (Owner only)
POST   /api/sales/:id/lock     # Lock sale (Owner only)
POST   /api/sales/:id/reverse  # Reverse sale (Owner only)
GET    /api/sales/receipt/:id  # Generate receipt PDF
```

### 2. REPAIRS MANAGEMENT

**Staff Capabilities:**

- Register new repair
- Input device details
- Describe issues
- Set estimated cost
- View assigned repairs

**Supervisor Capabilities:**

- All staff capabilities
- Assign repairs to technicians
- Update repair status
- Set completion dates
- View all repairs

**Owner Capabilities:**

- All supervisor capabilities
- Edit any repair field
- Change pricing
- Mark as completed
- Delete repairs
- View repair analytics
- Set warranty periods

**Status Workflow:**

```
Pending ‚Üí Diagnosed ‚Üí Parts Ordered ‚Üí In Progress ‚Üí 
Quality Check ‚Üí Completed ‚Üí Delivered
```

**Implementation Requirements:**

```python
# Repair Endpoints
POST   /api/repairs                    # Create repair
GET    /api/repairs                    # List repairs
GET    /api/repairs/:id                # Get single repair
PUT    /api/repairs/:id                # Update repair
DELETE /api/repairs/:id                # Delete repair
POST   /api/repairs/:id/status         # Change status
POST   /api/repairs/:id/assign         # Assign technician
GET    /api/repairs/:id/history        # Status history
POST   /api/repairs/:id/notify-customer # SMS/Email notification
```

### 3. DEVICE MANAGEMENT

**All Roles:**

- Register new device
- Search by IMEI/Serial
- Link to customer
- View repair history

**Owner/Supervisor:**

- Edit device details
- Update status
- Set pricing
- Delete devices
- Bulk import from CSV

**Implementation Requirements:**

```python
# Device Endpoints
POST   /api/devices           # Create device
GET    /api/devices           # List devices
GET    /api/devices/:id       # Get single device
PUT    /api/devices/:id       # Update device
DELETE /api/devices/:id       # Delete device
GET    /api/devices/:id/repairs # Repair history
POST   /api/devices/import    # Bulk import
```

### 4. INVENTORY MANAGEMENT

**Automatic Features:**

- Auto-deduct stock on sale
- Low stock alerts
- Reorder notifications
- Stock movement tracking

**Owner Capabilities:**

- Add/Edit/Delete products
- Adjust stock manually
- Set cost & selling price
- Set min stock levels
- View stock reports
- Generate purchase orders

**Implementation Requirements:**

```python
# Product/Inventory Endpoints
POST   /api/products              # Create product
GET    /api/products              # List products
GET    /api/products/:id          # Get single product
PUT    /api/products/:id          # Update product
DELETE /api/products/:id          # Delete product
POST   /api/products/:id/adjust   # Adjust stock
GET    /api/products/low-stock    # Low stock report
GET    /api/stock-movements       # Movement history
```

### 5. DAILY CLOSURE

**Staff Process:**

1. Count cash in drawer
1. Enter mobile money totals
1. Enter card payments
1. System calculates expected vs actual
1. Submit for review

**Supervisor/Owner:**

- Review submissions
- Edit if errors
- Approve/Reject
- Add notes
- Lock when finalized

**Implementation Requirements:**

```python
# Closure Endpoints
POST   /api/closures              # Create closure
GET    /api/closures              # List closures
GET    /api/closures/:id          # Get single closure
PUT    /api/closures/:id          # Update closure
POST   /api/closures/:id/approve  # Approve (Owner/Supervisor)
GET    /api/closures/date/:date   # Get by date
```

### 6. CUSTOMER MANAGEMENT

**All Roles:**

- Add new customer
- Search customers
- View purchase history
- View devices owned

**Owner/Supervisor:**

- Edit customer details
- Delete customers
- View lifetime value
- Export customer list
- Loyalty points management

**Implementation Requirements:**

```python
# Customer Endpoints
POST   /api/customers              # Create customer
GET    /api/customers              # List customers
GET    /api/customers/:id          # Get single customer
PUT    /api/customers/:id          # Update customer
DELETE /api/customers/:id          # Delete customer
GET    /api/customers/:id/purchases # Purchase history
GET    /api/customers/:id/devices  # Owned devices
```

### 7. STAFF MANAGEMENT (Owner Only)

**Features:**

- Add new staff
- Assign roles
- Activate/Deactivate
- Reset passwords
- View activity logs
- Set permissions
- Track performance

**Implementation Requirements:**

```python
# Staff Endpoints
POST   /api/staff                # Create staff
GET    /api/staff                # List staff
GET    /api/staff/:id            # Get single staff
PUT    /api/staff/:id            # Update staff
DELETE /api/staff/:id            # Delete staff
POST   /api/staff/:id/suspend    # Suspend staff
POST   /api/staff/:id/activate   # Activate staff
GET    /api/staff/:id/activity   # Activity logs
```

### 8. EXPENSE MANAGEMENT

**Staff:**

- Submit expense requests

**Supervisor:**

- Submit expenses
- View team expenses

**Owner:**

- Approve/Reject expenses
- View all expenses
- Generate expense reports
- Set budgets

**Implementation Requirements:**

```python
# Expense Endpoints
POST   /api/expenses              # Create expense
GET    /api/expenses              # List expenses
GET    /api/expenses/:id          # Get single expense
PUT    /api/expenses/:id          # Update expense
DELETE /api/expenses/:id          # Delete expense
POST   /api/expenses/:id/approve  # Approve expense
```

-----

## üì± FRONTEND SPECIFICATIONS

### Responsive Design Requirements

**Mobile-First (iPhone 12+):**

- Touch-optimized buttons (min 44x44px)
- Swipe gestures for actions
- Bottom navigation bar
- Pull-to-refresh
- Offline mode with sync
- Native app feel (PWA)

**Tablet (iPad):**

- Split-screen views
- Enhanced touch targets
- Optimized layouts

**Desktop:**

- Full dashboard with widgets
- Keyboard shortcuts
- Multi-window support
- Advanced filters

### UI Components Required

```html
<!-- Navigation -->
- Responsive sidebar/drawer
- Top header with user menu
- Breadcrumb navigation
- Mobile bottom nav

<!-- Forms -->
- Quick-add product buttons
- Autocomplete inputs
- Date/time pickers
- File upload (drag-drop)
- Form validation (real-time)

<!-- Tables -->
- Sortable columns
- Filterable
- Pagination
- Bulk actions
- Export buttons
- Mobile card view

<!-- Modals/Dialogs -->
- Confirmation dialogs
- Edit modals
- Detail views
- Image galleries

<!-- Notifications -->
- Toast messages
- Alert banners
- Badge counters
- Push notifications

<!-- Charts/Reports -->
- Line charts (sales trends)
- Bar charts (product performance)
- Pie charts (payment methods)
- KPI cards
- Date range selectors
```

### Page Structure

```
/login
/dashboard
/sales
  /new
  /:id
/repairs
  /new
  /:id
/devices
  /new
  /:id
/products
  /new
  /:id
/customers
  /new
  /:id
/closures
  /new
  /:id
/staff (Owner only)
  /new
  /:id
/expenses
  /new
  /:id
/reports
  /sales
  /repairs
  /inventory
  /financial
/settings
/profile
/audit-logs (Owner only)
```

-----

## üìä REPORTING & ANALYTICS

### Dashboard Widgets (Role-Based)

**Staff Dashboard:**

- Today‚Äôs sales count
- Pending repairs assigned
- Quick actions

**Supervisor Dashboard:**

- Today‚Äôs revenue
- Team performance
- Pending approvals
- Inventory alerts
- Repair status overview

**Owner Dashboard:**

- Revenue (daily/weekly/monthly)
- Profit margins
- Top products
- Top customers
- Staff performance
- Cash flow
- Repair completion rates
- Inventory turnover
- System health

### Reports Required

**Sales Reports:**

- Daily sales summary
- Sales by product
- Sales by staff
- Sales by payment method
- Sales trends (charts)
- Profit analysis

**Repair Reports:**

- Repairs by status
- Repairs by type
- Technician performance
- Average repair time
- Repair revenue

**Inventory Reports:**

- Current stock levels
- Low stock items
- Stock movement history
- Product performance
- Reorder recommendations

**Financial Reports:**

- Daily closure summary
- Cash flow statement
- Expense breakdown
- Profit & Loss
- Tax reports

**Customer Reports:**

- Customer lifetime value
- Top customers
- Customer acquisition
- Purchase patterns

**Staff Reports:**

- Performance metrics
- Sales per staff
- Attendance logs
- Commission calculations

### Export Formats

- PDF (formatted reports)
- Excel (.xlsx)
- CSV (raw data)
- JSON (API integration)

-----

## üîî NOTIFICATIONS & ALERTS

### Real-Time Notifications

**Low Stock Alerts:**

- Triggered when product < min_stock_level
- Notify: Owner, Supervisor
- Channel: In-app, Email

**Repair Updates:**

- Status changes
- Completion notifications
- Notify: Customer, Owner
- Channel: SMS, Email, In-app

**Sale Approvals:**

- New sale submitted
- Notify: Owner, Supervisor
- Channel: In-app, Push

**Daily Closure:**

- Submission pending
- Large variance detected
- Notify: Owner
- Channel: In-app, Email

**System Alerts:**

- Failed payments
- Database errors
- Low disk space
- Subscription expiring
- Notify: Owner
- Channel: Email, SMS

-----

## üîß TECHNICAL IMPLEMENTATION

### Backend Structure

```
project/
‚îú‚îÄ‚îÄ app.py (main application)
‚îú‚îÄ‚îÄ config.py (configuration)
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ product.py
‚îÇ   ‚îú‚îÄ‚îÄ sale.py
‚îÇ   ‚îú‚îÄ‚îÄ repair.py
‚îÇ   ‚îú‚îÄ‚îÄ device.py
‚îÇ   ‚îú‚îÄ‚îÄ customer.py
‚îÇ   ‚îú‚îÄ‚îÄ closure.py
‚îÇ   ‚îî‚îÄ‚îÄ audit.py
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îú‚îÄ‚îÄ sales.py
‚îÇ   ‚îú‚îÄ‚îÄ repairs.py
‚îÇ   ‚îú‚îÄ‚îÄ devices.py
‚îÇ   ‚îú‚îÄ‚îÄ products.py
‚îÇ   ‚îú‚îÄ‚îÄ customers.py
‚îÇ   ‚îú‚îÄ‚îÄ closures.py
‚îÇ   ‚îú‚îÄ‚îÄ staff.py
‚îÇ   ‚îú‚îÄ‚îÄ reports.py
‚îÇ   ‚îî‚îÄ‚îÄ api.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îú‚îÄ‚îÄ email_service.py
‚îÇ   ‚îú‚îÄ‚îÄ sms_service.py
‚îÇ   ‚îú‚îÄ‚îÄ pdf_service.py
‚îÇ   ‚îú‚îÄ‚îÄ export_service.py
‚îÇ   ‚îî‚îÄ‚îÄ notification_service.py
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py (permissions)
‚îÇ   ‚îú‚îÄ‚îÄ validators.py
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py
‚îÇ   ‚îî‚îÄ‚îÄ audit.py
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ base.html
‚îÇ   ‚îú‚îÄ‚îÄ login.html
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html
‚îÇ   ‚îú‚îÄ‚îÄ sales/
‚îÇ   ‚îú‚îÄ‚îÄ repairs/
‚îÇ   ‚îú‚îÄ‚îÄ devices/
‚îÇ   ‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îú‚îÄ‚îÄ customers/
‚îÇ   ‚îú‚îÄ‚îÄ closures/
‚îÇ   ‚îú‚îÄ‚îÄ staff/
‚îÇ   ‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ img/
‚îÇ   ‚îî‚îÄ‚îÄ vendor/
‚îú‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ README.md
```

### Key Dependencies

```txt
# requirements.txt
Flask==3.0.0
Flask-SQLAlchemy==3.1.1
Flask-Login==0.6.3
Flask-WTF==1.2.1
Flask-Migrate==4.0.5
Flask-CORS==4.0.0
Flask-SocketIO==5.3.5
psycopg2-binary==2.9.9
PyJWT==2.8.0
bcrypt==4.1.2
python-dotenv==1.0.0
celery==5.3.4
redis==5.0.1
reportlab==4.0.7
openpyxl==3.1.2
pandas==2.1.4
requests==2.31.0
Pillow==10.1.0
gunicorn==21.2.0
```

### Environment Variables

```bash
# .env
DATABASE_URL=postgresql://user:pass@localhost/phoneshop
SECRET_KEY=your-secret-key-here
JWT_SECRET_KEY=your-jwt-secret
REDIS_URL=redis://localhost:6379/0

# Email (SendGrid/AWS SES)
MAIL_SERVER=smtp.sendgrid.net
MAIL_PORT=587
MAIL_USERNAME=apikey
MAIL_PASSWORD=your-api-key
MAIL_FROM=noreply@yourshop.com

# SMS (Africa's Talking/Twilio)
SMS_API_KEY=your-sms-api-key
SMS_USERNAME=your-username

# Storage (AWS S3/Cloudinary)
STORAGE_TYPE=s3
AWS_ACCESS_KEY=your-access-key
AWS_SECRET_KEY=your-secret-key
AWS_BUCKET=your-bucket-name

# Payment (Flutterwave/Paystack)
PAYMENT_PUBLIC_KEY=your-public-key
PAYMENT_SECRET_KEY=your-secret-key

# App Settings
FLASK_ENV=production
DEBUG=False
TIMEZONE=Africa/Kampala
CURRENCY=UGX
```

-----

## üê≥ DEPLOYMENT

### Docker Configuration

```yaml
# docker-compose.yml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/phoneshop
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - db
      - redis
    volumes:
      - ./:/app
    command: gunicorn -w 4 -b 0.0.0.0:5000 app:app

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: phoneshop
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  celery:
    build: .
    command: celery -A app.celery worker --loglevel=info
    depends_on:
      - redis
      - db

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - web

volumes:
  postgres_data:
```

### Nginx Configuration

```nginx
# nginx.conf
upstream app {
    server web:5000;
}

server {
    listen 80;
    server_name yourshop.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourshop.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;

    client_max_body_size 50M;

    location / {
        proxy_pass http://app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /static {
        alias /app/static;
        expires 30d;
    }

    location /socket.io {
        proxy_pass http://app/socket.io;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

-----

## üß™ TESTING REQUIREMENTS

### Test Coverage

```python
# tests/test_sales.py
def test_create_sale_as_staff()
def test_create_sale_as_owner()
def test_edit_sale_as_staff_forbidden()
def test_edit_sale_as_owner()
def test_delete_sale_as_supervisor_forbidden()
def test_approve_sale_as_owner()
def test_lock_sale_as_owner()
def test_reverse_sale_with_audit()
def test_auto_stock_deduction()

# tests/test_repairs.py
def test_create_repair_with_device()
def test_assign_repair_to_technician()
def test_change_repair_status()
def test_edit_repair_as_supervisor()
def test_delete_repair_as_staff_forbidden()
def test_complete_repair_workflow()

# tests/test_permissions.py
def test_owner_can_access_all()
def test_supervisor_limited_access()
def test_staff_minimal_access()
def test_cross_tenant_isolation()

# tests/test_closures.py
def test_create_daily_closure()
def test_variance_calculation()
def test_approve_closure_as_owner()
def test_duplicate_closure_forbidden()
```

### Integration Tests

- End-to-end sale workflow
- Repair lifecycle testing
- Multi-user concurrent operations
- Real-time notification delivery
- Export functionality
- Authentication flows

### Performance Tests

- 1000+ concurrent users
- Database query optimization
- API response times < 200ms
- Mobile load speed < 3s

-----

## üìã SAAS FEATURES

### Multi-Tenant Architecture

**Tenant Isolation:**

- Complete data separation per shop
- Subdomain routing: `shop-name.yourplatform.com`
- Custom domain support: `pos.theirshop.com`
- Shared infrastructure, isolated data

**Subscription Management:**

```python
SUBSCRIPTION_PLANS = {
    'trial': {
        'duration_days': 14,
        'max_users': 2,
        'max_products': 50,
        'max_monthly_sales': 100,
        'features': ['basic_reports', 'email_support'],
        'price': 0
    },
    'starter': {
        'duration_days': 30,
        'max_users': 5,
        'max_products': 500,
        'max_monthly_sales': 1000,
        'features': ['advanced_reports', 'priority_support', 'sms_notifications'],
        'price': 50000  # UGX
    },
    'professional': {
        'duration_days': 30,
        'max_users': 20,
        'max_products': 5000,
        'max_monthly_sales': 10000,
        'features': ['all_reports', '24/7_support', 'api_access', 'custom_branding', 'multi_location'],
        'price': 150000  # UGX
    },
    'enterprise': {
        'duration_days': 30,
        'max_users': -1,  # unlimited
        'max_products': -1,
        'max_monthly_sales': -1,
        'features': ['all_features', 'dedicated_support', 'custom_integrations', 'white_label'],
        'price': 500000  # UGX
    }
}
```

**Subscription Endpoints:**

```python
GET    /api/subscription              # Current plan details
POST   /api/subscription/upgrade      # Upgrade plan
POST   /api/subscription/downgrade    # Downgrade plan
POST   /api/subscription/cancel       # Cancel subscription
GET    /api/subscription/invoice      # Download invoice
POST   /api/subscription/payment      # Process payment
```

### Onboarding Flow

**Step 1: Registration**

- Shop name
- Owner details
- Phone & email
- Choose plan (trial auto-selected)

**Step 2: Setup Wizard**

- Upload logo
- Set currency & timezone
- Add first products (preloaded suggested)
- Invite team members
- Configure payment methods

**Step 3: Training**

- Interactive tutorials
- Video walkthroughs
- Sample data generation
- First sale walkthrough

**Implementation:**

```python
POST   /api/auth/register            # Create new shop
POST   /api/onboarding/shop-details  # Setup shop
POST   /api/onboarding/products      # Add products
POST   /api/onboarding/invite-staff  # Invite team
POST   /api/onboarding/complete      # Mark complete
```

### Billing Integration

**Payment Gateways:**

- Flutterwave (MTN, Airtel, Card)
- Paystack
- Stripe (international)
- Manual bank transfer

**Billing Features:**

- Automatic subscription renewal
- Pro-rated upgrades
- Grace period (3 days)
- Invoice generation
- Payment history
- Failed payment retry

**Implementation:**

```python
# services/billing_service.py
class BillingService:
    def charge_subscription(shop_id, amount)
    def handle_payment_success(transaction_id)
    def handle_payment_failure(transaction_id)
    def send_payment_reminder(shop_id)
    def suspend_shop(shop_id)
    def reactivate_shop(shop_id)
    def generate_invoice(shop_id, period)
```

### White-Label Option

**Enterprise Features:**

- Custom domain
- Custom branding (logo, colors)
- Remove ‚ÄúPowered by‚Äù footer
- Custom email templates
- Custom SMS sender ID
- Dedicated subdomain

**Configuration:**

```python
# White-label settings
WHITE_LABEL_CONFIG = {
    'domain': 'pos.clientshop.com',
    'primary_color': '#1E40AF',
    'secondary_color': '#10B981',
    'logo_url': 'https://cdn.example.com/logo.png',
    'company_name': 'Client Shop Ltd',
    'email_from': 'system@clientshop.com',
    'sms_sender': 'CLIENTSHOP'
}
```

-----

## üîí SECURITY REQUIREMENTS

### Authentication Security

- Password hashing with bcrypt (cost factor: 12)
- JWT tokens with short expiry (15 min)
- Refresh token rotation
- Account lockout after 5 failed attempts
- Password complexity requirements
- 2FA optional (TOTP via Google Authenticator)
- Session invalidation on password change

### Authorization Security

- Role-based access control (RBAC)
- Permission checks on every endpoint
- Database row-level security
- Tenant isolation validation
- API rate limiting (100 req/min per user)
- IP whitelisting option

### Data Security

- SQL injection prevention (parameterized queries)
- XSS protection (input sanitization)
- CSRF tokens on forms
- HTTPS only (SSL/TLS)
- Encrypted sensitive fields (credit cards, passwords)
- Secure file upload validation
- Content Security Policy headers

### Audit & Compliance

- Complete audit trail
- GDPR compliance ready
- Data export functionality
- Right to deletion
- Data retention policies
- Privacy policy & terms

**Security Implementation:**

```python
# utils/decorators.py
def require_permission(permission):
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            if not current_user.has_permission(permission):
                abort(403)
            return f(*args, **kwargs)
        return decorated_function
    return decorator

def require_role(*roles):
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            if current_user.role not in roles:
                abort(403)
            return f(*args, **kwargs)
        return decorated_function
    return decorator

def require_shop_access(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        shop_id = kwargs.get('shop_id') or request.json.get('shop_id')
        if current_user.shop_id != shop_id:
            abort(403)
        return f(*args, **kwargs)
    return decorated_function
```

-----

## üì± MOBILE APP SPECIFICATIONS

### Progressive Web App (PWA)

**Features:**

- Install to home screen
- Offline functionality
- Push notifications
- Background sync
- Camera access (barcode scanning)
- Touch ID / Face ID support

**Manifest Configuration:**

```json
{
  "name": "Phone Shop POS",
  "short_name": "ShopPOS",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#1E40AF",
  "orientation": "portrait",
  "icons": [
    {
      "src": "/static/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/static/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

**Service Worker:**

```javascript
// Cache-first strategy for static assets
// Network-first strategy for API calls
// Background sync for offline operations
```

### Native Mobile App Option

**React Native / Flutter:**

- iOS & Android support
- Native camera integration
- Biometric authentication
- Faster performance
- Better offline experience
- App Store distribution

-----

## üîå API DOCUMENTATION

### REST API Endpoints

**Base URL:** `https://api.yourplatform.com/v1`

**Authentication:**

```
Authorization: Bearer {jwt_token}
X-Shop-ID: {shop_id}
```

**Common Response Format:**

```json
{
  "success": true,
  "data": {},
  "message": "Operation successful",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

**Error Response:**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": {
      "email": ["Email is required"]
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### Webhook Support

**Events:**

- `sale.created`
- `sale.updated`
- `sale.approved`
- `repair.status_changed`
- `repair.completed`
- `stock.low_alert`
- `closure.submitted`
- `payment.success`
- `payment.failed`

**Webhook Payload:**

```json
{
  "event": "sale.created",
  "shop_id": 123,
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "sale_id": 456,
    "total_amount": 150000,
    "created_by": "John Doe"
  }
}
```

**Webhook Configuration:**

```python
POST   /api/webhooks              # Create webhook
GET    /api/webhooks              # List webhooks
PUT    /api/webhooks/:id          # Update webhook
DELETE /api/webhooks/:id          # Delete webhook
GET    /api/webhooks/:id/logs     # Delivery logs
```

-----

## üìä ADVANCED FEATURES

### 1. Barcode Scanning

- Scan product barcodes during sale
- Scan device IMEI for quick lookup
- Generate barcodes for products
- Print barcode labels

**Implementation:**

```javascript
// Use QuaggaJS or ZXing
function scanBarcode() {
  Quagga.init({
    inputStream: {
      name: "Live",
      type: "LiveStream",
      target: document.querySelector('#scanner')
    },
    decoder: {
      readers: ["ean_reader", "code_128_reader"]
    }
  }, function(err) {
    if (err) { console.log(err); return; }
    Quagga.start();
  });
  
  Quagga.onDetected(function(result) {
    const code = result.codeResult.code;
    searchProduct(code);
  });
}
```

### 2. Receipt Printing

**Thermal Printer Support:**

- ESC/POS protocol
- USB/Bluetooth connectivity
- Custom receipt templates
- Logo printing

**Receipt Template:**

```python
def generate_receipt(sale_id):
    sale = Sale.query.get(sale_id)
    
    receipt = f"""
    {'='*40}
    {shop.name.center(40)}
    {shop.address.center(40)}
    Tel: {shop.phone}
    {'='*40}
    
    Receipt No: {sale.sale_number}
    Date: {sale.created_at.strftime('%Y-%m-%d %H:%M')}
    Cashier: {sale.created_by}
    
    {'='*40}
    {'Item':<20} {'Qty':>5} {'Price':>12}
    {'-'*40}
    """
    
    for item in sale.items:
        receipt += f"\n{item.name:<20} {item.quantity:>5} {item.total:>12,}"
    
    receipt += f"""
    {'-'*40}
    {'Subtotal:':<25} {sale.total_amount:>12,}
    {'Discount:':<25} {sale.discount_amount:>12,}
    {'Tax:':<25} {sale.tax_amount:>12,}
    {'='*40}
    {'TOTAL:':<25} {sale.final_amount:>12,}
    {'='*40}
    
    Payment: {sale.payment_method}
    
    Thank you for your business!
    {'='*40}
    """
    
    return receipt
```

### 3. SMS Notifications

**Use Cases:**

- Repair status updates
- Payment reminders
- Low stock alerts
- Promotional messages
- Order ready notifications

**Integration (Africa‚Äôs Talking):**

```python
import africastalking

africastalking.initialize(username='yourapp', api_key='your-key')
sms = africastalking.SMS

def send_repair_notification(repair_id):
    repair = Repair.query.get(repair_id)
    customer = repair.customer
    
    message = f"Dear {customer.name}, your {repair.device_brand} {repair.device_model} repair is now {repair.status}. Collect at {shop.name}."
    
    try:
        response = sms.send(message, [customer.phone])
        log_notification(repair_id, 'SMS', response)
    except Exception as e:
        log_error(str(e))
```

### 4. Email Notifications

**Email Templates:**

- Welcome email
- Password reset
- Repair notifications
- Invoice emails
- Report delivery
- Subscription reminders

**Implementation (SendGrid):**

```python
from sendgrid import SendGridAPIClient
from sendgrid.helpers.mail import Mail

def send_invoice_email(sale_id):
    sale = Sale.query.get(sale_id)
    customer = sale.customer
    
    message = Mail(
        from_email='noreply@yourshop.com',
        to_emails=customer.email,
        subject=f'Invoice #{sale.sale_number}',
        html_content=render_template('emails/invoice.html', sale=sale)
    )
    
    sg = SendGridAPIClient(os.environ.get('SENDGRID_API_KEY'))
    response = sg.send(message)
    return response.status_code
```

### 5. Backup & Restore

**Automated Backups:**

- Daily database backups
- Hourly incremental backups
- Cloud storage (S3/Google Cloud)
- Retention policy (30 days)
- One-click restore

**Implementation:**

```bash
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups"
DB_NAME="phoneshop"

# PostgreSQL backup
pg_dump $DB_NAME | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# Upload to S3
aws s3 cp $BACKUP_DIR/db_$DATE.sql.gz s3://your-bucket/backups/

# Delete old backups (keep 30 days)
find $BACKUP_DIR -name "db_*.sql.gz" -mtime +30 -delete
```

### 6. Multi-Location Support (Enterprise)

**Features:**

- Multiple shop branches
- Centralized inventory
- Inter-branch transfers
- Branch-specific reports
- Staff assignment to branches

**Database Schema Addition:**

```sql
CREATE TABLE locations (
    id SERIAL PRIMARY KEY,
    shop_id INTEGER REFERENCES shops(id),
    name VARCHAR(200) NOT NULL,
    address TEXT,
    phone VARCHAR(20),
    manager_id INTEGER REFERENCES users(id),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Add location_id to relevant tables
ALTER TABLE sales ADD COLUMN location_id INTEGER REFERENCES locations(id);
ALTER TABLE repairs ADD COLUMN location_id INTEGER REFERENCES locations(id);
ALTER TABLE users ADD COLUMN location_id INTEGER REFERENCES locations(id);
```

### 7. Commission Tracking

**Staff Commission:**

- Commission per sale
- Commission per repair
- Tiered commission rates
- Monthly commission reports
- Automatic calculation

**Implementation:**

```python
class CommissionRule(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    shop_id = db.Column(db.Integer, db.ForeignKey('shops.id'))
    user_id = db.Column(db.Integer, db.ForeignKey('users.id'))
    type = db.Column(db.String(20))  # 'percentage' or 'fixed'
    value = db.Column(db.Float)  # 5.0 for 5% or 5000 for UGX 5000
    applies_to = db.Column(db.String(20))  # 'sales' or 'repairs'
    
def calculate_commission(sale_id, user_id):
    sale = Sale.query.get(sale_id)
    rule = CommissionRule.query.filter_by(
        user_id=user_id,
        applies_to='sales'
    ).first()
    
    if not rule:
        return 0
    
    if rule.type == 'percentage':
        return sale.final_amount * (rule.value / 100)
    else:
        return rule.value
```

### 8. Loyalty Program

**Customer Rewards:**

- Points per purchase
- Point redemption
- Tiered membership
- Birthday rewards
- Referral bonuses

**Implementation:**

```python
class LoyaltyTransaction(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    customer_id = db.Column(db.Integer, db.ForeignKey('customers.id'))
    points = db.Column(db.Integer)
    transaction_type = db.Column(db.String(20))  # 'earn' or 'redeem'
    reference_type = db.Column(db.String(20))
    reference_id = db.Column(db.Integer)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

def award_points(sale_id):
    sale = Sale.query.get(sale_id)
    customer = sale.customer
    
    # 1 point per 1000 UGX spent
    points = sale.final_amount // 1000
    
    transaction = LoyaltyTransaction(
        customer_id=customer.id,
        points=points,
        transaction_type='earn',
        reference_type='sale',
        reference_id=sale.id
    )
    
    customer.loyalty_points += points
    db.session.add(transaction)
    db.session.commit()
```

### 9. Analytics Dashboard

**Advanced Metrics:**

- Customer lifetime value
- Average transaction value
- Inventory turnover rate
- Repair completion time
- Staff performance score
- Revenue forecasting
- Seasonal trends

**Implementation (Chart.js):**

```javascript
// Revenue trend chart
const ctx = document.getElementById('revenueChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            label: 'Revenue',
            data: [450000, 520000, 480000, 650000, 720000, 680000],
            borderColor: 'rgb(59, 130, 246)',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Monthly Revenue Trend'
            }
        }
    }
});
```

### 10. Inventory Alerts & Automation

**Smart Features:**

- Auto-reorder when stock low
- Supplier integration
- Demand forecasting
- Expiry date tracking
- Batch/lot tracking

**Implementation:**

```python
from celery import Celery
from datetime import datetime, timedelta

celery = Celery('tasks', broker='redis://localhost:6379/0')

@celery.task
def check_low_stock():
    """Run daily to check stock levels"""
    low_stock_products = Product.query.filter(
        Product.stock_quantity <= Product.min_stock_level,
        Product.is_active == True
    ).all()
    
    for product in low_stock_products:
        # Send notification to owner
        notify_owner(
            shop_id=product.shop_id,
            title='Low Stock Alert',
            message=f'{product.name} is running low. Current stock: {product.stock_quantity}'
        )
        
        # Auto-generate purchase order
        if product.auto_reorder:
            create_purchase_order(product.id, product.reorder_quantity)

@celery.task
def check_expiring_items():
    """Check for items expiring soon"""
    threshold_date = datetime.now() + timedelta(days=30)
    
    expiring = Product.query.filter(
        Product.expiry_date <= threshold_date,
        Product.expiry_date >= datetime.now()
    ).all()
    
    for product in expiring:
        notify_owner(
            shop_id=product.shop_id,
            title='Expiring Stock',
            message=f'{product.name} expires on {product.expiry_date.strftime("%Y-%m-%d")}'
        )
```

-----

## üé® UI/UX DESIGN GUIDELINES

### Design Principles

1. **Simplicity First:** Clean, uncluttered interface
1. **Speed Matters:** Fast actions, minimal clicks
1. **Mobile-Optimized:** Touch-friendly, thumb-reachable
1. **Accessibility:** WCAG 2.1 AA compliant
1. **Consistency:** Uniform patterns across all pages

### Color Scheme

```css
:root {
  /* Primary Colors */
  --primary-600: #1E40AF;      /* Main brand color */
  --primary-700: #1E3A8A;
  --primary-500: #3B82F6;
  
  /* Secondary Colors */
  --success-500: #10B981;      /* Green for success */
  --warning-500: #F59E0B;      /* Orange for warnings */
  --danger-500: #EF4444;       /* Red for errors */
  --info-500: #06B6D4;         /* Cyan for info */
  
  /* Neutral Colors */
  --gray-50: #F9FAFB;
  --gray-100: #F3F4F6;
  --gray-200: #E5E7EB;
  --gray-300: #D1D5DB;
  --gray-400: #9CA3AF;
  --gray-500: #6B7280;
  --gray-600: #4B5563;
  --gray-700: #374151;
  --gray-800: #1F2937;
  --gray-900: #111827;
}
```

### Typography

```css
/* Font Stack */
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, 
             "Helvetica Neue", Arial, sans-serif;

/* Size Scale */
--text-xs: 0.75rem;      /* 12px */
--text-sm: 0.875rem;     /* 14px */
--text-base: 1rem;       /* 16px */
--text-lg: 1.125rem;     /* 18px */
--text-xl: 1.25rem;      /* 20px */
--text-2xl: 1.5rem;      /* 24px */
--text-3xl: 1.875rem;    /* 30px */
--text-4xl: 2.25rem;     /* 36px */
```

### Component Library

- Buttons (primary, secondary, danger, ghost)
- Input fields (text, number, date, select, textarea)
- Cards (shadow, border, hover states)
- Tables (sortable, filterable, responsive)
- Modals (center, side drawer, full screen)
- Toasts/Alerts (success, error, warning, info)
- Loading states (spinners, skeletons)
- Empty states (illustrations, helpful text)

-----

## üìö DOCUMENTATION REQUIREMENTS

### User Documentation

1. **Quick Start Guide** (PDF + Video)
- First login
- Adding products
- Making first sale
- Creating repair ticket
1. **User Manual** (Web-based)
- Detailed feature guides
- Screenshots
- Step-by-step tutorials
- FAQs
1. **Video Tutorials**
- Dashboard overview (3 min)
- Sales process (5 min)
- Repair management (7 min)
- Reports & analytics (6 min)
- Staff management (4 min)

### Developer Documentation

1. **API Reference**
- Complete endpoint documentation
- Request/response examples
- Authentication guide
- Error codes
1. **Database Schema**
- ER diagrams
- Table descriptions
- Relationships
- Indexes
1. **Deployment Guide**
- Server requirements
- Installation steps
- Configuration
- Troubleshooting
1. **Contribution Guide**
- Code style
- Git workflow
- Testing requirements
- Pull request process

-----

## üöÄ LAUNCH CHECKLIST

### Pre-Launch

- [ ] Complete all core features
- [ ] Write comprehensive tests (>80% coverage)
- [ ] Security audit
- [ ] Performance optimization
- [ ] Mobile responsiveness verified
- [ ] Browser compatibility (Chrome, Firefox, Safari, Edge)
- [ ] SSL certificate installed
- [ ] Backup system configured
- [ ] Monitoring setup (Sentry, New Relic)
- [ ] Documentation complete
- [ ] Demo environment ready
- [ ] Marketing website live
- [ ] Payment gateway integrated
- [ ] Email/SMS configured
- [ ] Legal pages (Terms, Privacy, Refund)

### Launch Day

- [ ] Deploy to production
- [ ] DNS configured
- [ ] CDN setup
- [ ] Monitoring active
- [ ] Support team ready
- [ ] Social media announcement
- [ ] Email to beta users
- [ ] Press release (if applicable)

### Post-Launch

- [ ] Monitor error logs
- [ ] Track user signups
- [ ] Collect feedback
- [ ] Fix critical bugs (24h)
- [ ] Weekly feature updates
- [ ] Monthly user surveys
- [ ] Quarterly reviews

-----

## üí∞ PRICING STRATEGY

### Subscription Tiers

**Trial (14 Days)**

- Free
- 2 users
- 50 products
- 100 monthly sales
- Basic reports
- Email support

**Starter - UGX 50,000/month**

- 5 users
- 500 products
- 1,000 monthly sales
- Advanced reports
- SMS notifications (100/month)
- Priority support

**Professional - UGX 150,000/month**

- 20 users
- 5,000 products
- 10,000 monthly sales
- All reports & exports
- SMS notifications (1,000/month)
- API access
- Custom branding
- 24/7 support

**Enterprise - UGX 500,000/month**

- Unlimited users
- Unlimited products
- Unlimited sales
- All features
- Unlimited SMS
- White-label
- Dedicated support
- Custom integrations
- Training included

### Add-Ons

- Extra SMS credits: UGX 50/SMS
- Additional locations: UGX 20,000/location/month
- Priority support: UGX 30,000/month
- Custom development: UGX 100,000/hour

-----

## üìà GROWTH STRATEGY

### Marketing Channels

1. **Digital Marketing**
- Google Ads (Search/Display)
- Facebook/Instagram ads
- YouTube tutorials
- SEO optimization
- Content marketing (blog)
1. **Partnerships**
- Phone repair associations
- Retail equipment suppliers
- Telecom companies
- Business incubators
1. **Referral Program**
- Refer a shop: 20% commission for 6 months
- Referred shop: 10% discount first 3 months
1. **Events**
- Trade shows
- Webinars
- Local meetups
- Training workshops

### Customer Acquisition

- Free trial (no credit card required)
- Demo booking
- Free setup assistance
- Migration from competitors
- Money-back guarantee (30 days)

### Customer Retention

- Excellent support
- Regular feature updates
- User community forum
- Success stories/case studies
- Loyalty discounts
- Annual payment discounts (15% off)

-----

## üîß MAINTENANCE & SUPPORT

### Support Channels

1. **In-App Chat** (Business hours)
1. **Email Support** (support@yourplatform.com)
1. **Phone Support** (For Pro+ plans)
1. **Knowledge Base** (24/7 self-service)
1. **Community Forum**
1. **Video Call Support** (Scheduled)

### SLA (Service Level Agreement)

- **Uptime:** 99.9%
- **Response Time:**
  - Critical: 2 hours
  - High: 8 hours
  - Medium: 24 hours
  - Low: 48 hours
- **Resolution Time:**
  - Critical: 24 hours
  - High: 3 days
  - Medium: 1 week
  - Low: 2 weeks

### Maintenance Windows

- Weekly: Saturday 2-4 AM (system updates)
- Monthly: First Sunday 2-6 AM (major updates)
- Emergency: As needed (notified 1 hour ahead)

-----

## üéØ SUCCESS METRICS (KPIs)

### Business Metrics

- Monthly Recurring Revenue (MRR)
- Customer Acquisition Cost (CAC)
- Customer Lifetime Value (CLV)
- Churn Rate
- Conversion Rate (trial to paid)

### Product Metrics

- Daily/Monthly Active Users
- Feature adoption rate
- Average session duration
- Pages per session
- Mobile vs desktop usage

### Support Metrics

- First response time
- Resolution time
- Customer satisfaction score (CSAT)
- Net Promoter Score (NPS)
- Support ticket volume

-----

## üèÅ FINAL DELIVERABLES

When you receive this prompt, generate a COMPLETE, PRODUCTION-READY system with:

### 1. Backend Files

```
‚úÖ app.py (main application)
‚úÖ config.py (environment config)
‚úÖ models/ (all database models)
‚úÖ routes/ (all API endpoints)
‚úÖ services/ (business logic)
‚úÖ utils/ (helpers, decorators)
‚úÖ migrations/ (database migrations)
‚úÖ requirements.txt
‚úÖ
```